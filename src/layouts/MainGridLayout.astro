---
import Footer from '@components/Footer.astro'
import Navbar from '@components/Navbar.astro'
import BackToTop from '@components/control/BackToTop.astro'
import SideBar from '@components/widget/SideBar.astro'
import { Icon } from 'astro-icon/components'
import { siteConfig } from '../config'
import Layout from './Layout.astro'

interface Props {
	title?: string
	banner?: string
	description?: string
	lang?: string
	ogImage?: string
	setOGTypeArticle?: boolean
}

const { title, banner, description, lang, setOGTypeArticle, ogImage } =
	Astro.props
const hasBannerCredit =
	siteConfig.banner.enable && siteConfig.banner.credit.enable
const hasBannerLink = !!siteConfig.banner.credit.url
---

<Layout
	title={title}
	banner={banner}
	description={description}
	lang={lang}
	ogImage={ogImage}
	setOGTypeArticle={setOGTypeArticle}
>
	<slot slot="head" name="head" />
	<div
		id="top-row"
		class="z-50 pointer-events-none relative transition-all duration-700 max-w-[var(--page-width)] px-0 md:px-4 mx-auto"
		class:list={[""]}
	>
		<div
			id="navbar-wrapper"
			class="pointer-events-auto sticky top-0 transition-all"
		>
			<Navbar />
		</div>
	</div>

	<div
		class="absolute w-full"
		class:list={[
			{
				"top-[30vh]": siteConfig.banner.enable,
				"top-[5.5rem]": !siteConfig.banner.enable,
			},
		]}
	>
		<div class="relative max-w-[var(--page-width)] mx-auto">
			<div
				id="main-grid"
				class="transition duration-700 w-full left-0 right-0 grid grid-cols-[17.5rem_auto] grid-rows-[auto_1fr_auto] lg:grid-rows-[auto]
    mx-auto gap-4 px-0 md:px-4"
			>
				<!-- Banner image credit -->
				{
					hasBannerCredit && (
						<a
							href={siteConfig.banner.credit.url}
							id="banner-credit"
							target="_blank"
							rel="noopener"
							aria-label="Visit image source"
							class:list={[
								"group onload-animation transition-all absolute flex justify-center items-center rounded-full " +
									"px-3 right-4 -top-[3.25rem] bg-black/60 hover:bg-black/70 h-9",
								{
									"hover:pr-9 active:bg-black/80":
										hasBannerLink,
								},
							]}
						>
							<Icon
								class="text-white/75 text-[1.25rem] mr-1"
								name="material-symbols:copyright-outline-rounded"
							/>
							<div class="text-white/75 text-xs">
								{siteConfig.banner.credit.text}
							</div>
							<Icon
								class:list={[
									"transition absolute text-[oklch(0.75_0.14_var(--hue))] right-4 text-[0.75rem] opacity-0",
									{
										"group-hover:opacity-100":
											hasBannerLink,
									},
								]}
								name="fa6-solid:arrow-up-right-from-square"
							/>
						</a>
					)
				}

				<SideBar
					class="mb-4 row-start-2 row-end-3 col-span-2 lg:row-start-1 lg:row-end-2 lg:col-span-1 lg:max-w-[17.5rem] onload-animation"
				/>

				<main
					id="swup-container"
					class="transition-swup-fade col-span-2 lg:col-span-1 overflow-hidden"
				>
					<div id="content-wrapper" class="onload-animation">
						<!-- the overflow-hidden here prevent long text break the layout-->
						<!-- make id different from windows.swup global property -->
						<slot />
						<div
							class="footer col-span-2 onload-animation hidden lg:block"
						>
							<Footer />
						</div>
					</div>
				</main>

				<div class="footer col-span-2 onload-animation block lg:hidden">
					<Footer />
				</div>
			</div>
			<BackToTop />
		</div>
	</div>
</Layout>
